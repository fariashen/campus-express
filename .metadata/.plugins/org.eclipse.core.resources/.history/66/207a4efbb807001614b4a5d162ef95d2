package easyCourierHttpPost;

import java.io.UnsupportedEncodingException;
import java.util.ArrayList;
import java.util.List;

import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.message.BasicNameValuePair;
import org.apache.http.protocol.HTTP;
import org.json.JSONException;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;

import com.example.easycourier.ItemBean;
import com.example.easycourier.MyBaseAdapter;

import easyCourierFunction.Login;
import easyCourierFunction.ShowAcceptedRequest;
import easyCourierFunction.ShowRequestAllInfo;

public class SARHttpPost extends HttpPostRequest {

	// 保存已解释的json数据
	public static List<ItemBean> itemBeanList = new ArrayList<ItemBean>();

	// 要添加数据的数据项
	private ItemBean mItemBean;
	private String itemOrederId;
	private String itemProviderName;
	private String itemNickName;
	private String itemReward;
	private String itemAddForm;
	private String itemAddTo;
	private String itemTimeLimit;
	private String itemSize;
	private String itemPhone;
	private String itemKind;
	private String itemRemarks;

	// 数据适配器
	private MyBaseAdapter myBaseAdapter;

	// 启动Activity的成员变量
	private Intent mIntent;

	// 将用户点击的Item的所有信息值写入Bundle
	// 在启动RequestDetailShow.class的时候，将Bundle传过去
	private Bundle bundle;
	
	@Override
	protected void setUrlAddress() {
		// TODO Auto-generated method stub
		urlAddress = "http://www.caiweicheng.cn/phpserver/ordaccept.php";

	}

	@Override
	protected void setParamsIntoPost() {
		
		//TODO 参数：用户名
		params.add(new BasicNameValuePair("userName", Login.LOGIN_USERNAME));
		params.add(new BasicNameValuePair("orderID", ));
		
		try {
			mHttpPost.setEntity(new UrlEncodedFormEntity(params,HTTP.UTF_8));
		} catch (UnsupportedEncodingException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}

	@Override
	protected void setIsJsonData() {

		isJsonData = true;
	}

	@Override
	protected void getDifferentJsonArrayValue() {


		try {
			itemOrederId = mJsonObject.getString("orderID");
			itemProviderName = mJsonObject.getString("providerName");
			itemNickName = mJsonObject.getString("nickName");
			itemReward = mJsonObject.getString("reward");
			itemAddForm = mJsonObject.getString("addForm");
			itemAddTo = mJsonObject.getString("addTo");
			itemTimeLimit = mJsonObject.getString("timeLimit");
			itemSize = mJsonObject.getString("size");
			itemPhone = mJsonObject.getString("phone");
			itemKind = mJsonObject.getString("kinds");
			itemRemarks = mJsonObject.getString("remarks");

			mItemBean = new ItemBean(itemOrederId, itemProviderName,
					itemNickName, itemReward, itemAddForm, itemAddTo,
					itemTimeLimit, itemSize, itemPhone, itemKind, itemRemarks);

			itemBeanList.add(mItemBean);

		} catch (JSONException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	@Override
	protected void backToMainThreadHandleMessage() {

		//向主线程发送更新UI请求
				ShowAcceptedRequest.SAR_Handler.post(new Runnable() {
					
					@Override
					public void run() {
						// 实例化Adapter
						myBaseAdapter = new MyBaseAdapter(ShowAcceptedRequest.mContext
								, itemBeanList);

						// 将ListView绑定数据适配器
						ShowAcceptedRequest.lv_ShowAccepted.setAdapter(myBaseAdapter);

						ShowAcceptedRequest.lv_ShowAccepted
								.setOnItemClickListener(new OnItemClickListener() {

									@Override
									public void onItemClick(AdapterView<?> parent,
											View view, int position, long id) {
										// TODO
										/**
										 * 
										 * 获取被点击的数据项的所有信息
										 * 
										 * 根据获取的信息设置RequestDetailShow.class的控件值
										 * 
										 */

										// 启动RequestDetailShow.class 查看详细信息
										mIntent = new Intent(ShowAcceptedRequest.mContext,
												ShowRequestAllInfo.class);

										bundle = new Bundle();

										// 将设置详细信息控件的参数传入
										bundle.putString(
												"orderId",
												itemBeanList.get(position - 1).itemOrederId);

										bundle.putString(
												"providerName",
												itemBeanList.get(position - 1).itemProviderName);

										bundle.putString(
												"nickName",
												itemBeanList.get(position - 1).itemNickName);

										bundle.putString(
												"reward",
												itemBeanList.get(position - 1).itemReward);

										bundle.putString(
												"addForm",
												itemBeanList.get(position - 1).itemAddForm);

										bundle.putString(
												"addTo",
												itemBeanList.get(position - 1).itemAddTo);

										bundle.putString(
												"timeLimit",
												itemBeanList.get(position - 1).itemTimeLimit);

										bundle.putString("size",
												itemBeanList.get(position - 1).itemSize);

										bundle.putString(
												"phone",
												itemBeanList.get(position - 1).itemPhone);

										bundle.putString("kinds",
												itemBeanList.get(position - 1).itemKind);

										bundle.putString(
												"remarks",
												itemBeanList.get(position - 1).itemRemarks);

										mIntent.putExtra("ItemAllInfo", bundle);

										ShowAcceptedRequest.mContext.startActivity(mIntent);

									}
								});
						
					}
				});
	}

}
